!function t(e,n,i){function r(o,a){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return r(n?n:t)},h,h.exports,t,e,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){(function(i,r){var s=t("./model"),o=t("./collection");n.Model=s.createClass(),n.Collection=o.createClass(),n.createModelClass=s.createClass,n.createCollectionClass=o.createClass,n.setVirtuals=t("./set-virtuals"),n.load=t("./load"),n.singleton=t("./singleton"),n.save=t("./save"),n.watchProperty=t("./watch-property"),n.bindProperty=t("./bind-property"),n.watchModelsMixin=t("./watch-models-mixin"),n.getAsync=t("./get-async"),n.recycle=t("./recycle"),n.reference=t("./reference"),i.browser&&(r.Caplet=e.exports)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bind-property":2,"./collection":3,"./get-async":5,"./load":6,"./model":8,"./recycle":9,"./reference":10,"./save":11,"./set-virtuals":12,"./singleton":13,"./watch-models-mixin":14,"./watch-property":15,_process:16}],2:[function(t,e){var n=t("./watch-property");e.exports=function(t,e,i,r){r||(r=e),"string"==typeof i&&(r=i,i=t);var s=n(t,e,function(t){i.set(r,t)});return s}},{"./watch-property":15}],3:[function(t,e){function n(t){var e={};t||(t={}),"[object Array]"===Object.prototype.toString.call(t)?e.source=t:e=t,this.getInitialProperties&&(e=a({},this.getInitialProperties(),e)),this._emitter=new r,i.call(this),this.setProperties(e),this.createModel=this.createModel.bind(this);var n=this;s(this,"data",this.onDataChange).trigger(),this.watch(function(){n._watchModels()}),this.initialize(),this.onChange&&this.watch(function(){n.onChange()}),this._watchModels()}var i=t("watchable-collection"),r=t("fast-event-emitter"),s=t("./watch-property"),o=t("./model").createClass(),a=t("xtend/mutable"),c=t("./missing-property-mixin");i.extend(n,{modelClass:o,on:function(){return this._emitter.on.apply(this._emitter,arguments)},once:function(){return this._emitter.once.apply(this._emitter,arguments)},emit:function(){return this._emitter.emit.apply(this._emitter,arguments)},initialize:function(){},createModel:function(t){return new this.modelClass(t)},fromData:function(t){return{source:this.castModels(t)}},toData:function(){return this.source.map(function(t){return t.toData()})},toJSON:function(){return this.toData()},onDataChange:function(t){var e=this.fromData(t);e.source=this.mergeSource(e.source),this.setProperties(e)},get:c.get,mergeSource:function(t){for(var e=t.concat(),n=this.source,i=t.length;i--;)for(var r=t[i],s=n.length;s--;){var o=n[s];if(r.equals(o)){o.set("data",r.toData()),e.splice(i,1,o);break}}return e},castModels:function(t){var e=this;return(t||[]).map(function(t){return e.createModel({data:t})})},_watchModels:function(){this._unwatchModels(),this._modelListeners=[];var t=this,e=function(){t._onChange()};this.source.forEach(function(n){t._modelListeners.push(n.watch(e)),t._modelListeners.push(n.once("dispose",function(){t.splice(t.indexOf(n),1)}))})},_unwatchModels:function(){if(this._modelListeners){for(var t=this._modelListeners.length;t--;)this._modelListeners[t].dispose();this._modelListeners=void 0}},dispose:function(){i.prototype.dispose.call(this),this.emit("dispose")}});var u=n.extend;n.extend=function(t){function e(t){return this instanceof i?void i.call(this,t):new e(t)}var i=this;if(t&&t.mixins){var r=t.mixins;a.apply(void 0,[t].concat(r))}return u.call(i,e,t),e.extend=n.extend,e},n.createClass=n.extend.bind(n),e.exports=n},{"./missing-property-mixin":7,"./model":8,"./watch-property":15,"fast-event-emitter":17,"watchable-collection":19,"xtend/mutable":22}],4:[function(t,e){(function(t){e.exports=function(e,n){if(!t.browser)return e;var i;return function(){clearTimeout(i),i=setTimeout(e,n)}}}).call(this,t("_process"))},{_process:16}],5:[function(t,e){var n=t("./watch-property");e.exports=function(t,e,i){var r=n(t,e,function(t){r.dispose(),i(void 0,t)});r.trigger()}},{"./watch-property":15}],6:[function(t,e){var n=t("./singleton");e.exports=function(t,e,i){n(t,"load",e,function(e,n){return e?i(e):(t.set("data",n),void i(null,t))})}},{"./singleton":13}],7:[function(t,e){var n=t("watchable-object");e.exports={get:function(t){var e=n.prototype.get.call(this,t);if(void 0!=e)return e;var i=("string"==typeof t?t.split("."):t)[0];return this._missingProperties||(this._missingProperties={}),this._missingProperties[i]?void 0:(this.emit("missingProperty",this._missingProperties[i]=i),void 0!=this[i]?this.get(t):void 0)}}},{"watchable-object":21}],8:[function(t,e){function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){t=n(t)?t:{data:t},this.getInitialProperties&&(t=a({},this.getInitialProperties(),t)),r.call(this,t),this._emitter=new s;var e=this;o(this,"data",this.onDataChange).trigger(),this.initialize(),this.onChange&&this.watch(function(){e.onChange()})}var r=t("watchable-object"),s=t("fast-event-emitter"),o=t("./watch-property"),a=t("xtend/mutable"),c=t("./missing-property-mixin");r.extend(i,{on:function(){return this._emitter.on.apply(this._emitter,arguments)},once:function(){return this._emitter.once.apply(this._emitter,arguments)},emit:function(){return this._emitter.emit.apply(this._emitter,arguments)},initialize:function(){},fromData:function(t){return n(t)?t:{}},toData:function(){var t={},e=this.data?this.data:this;if(!n(e))return e;for(var i in e)e===this&&(i in this.constructor.prototype||95===i.charCodeAt(0))||(t[i]=e[i]);return t},equals:function(t){return this.uid&&this.uid===t.uid||this.data===t.data},toJSON:function(){return this.toData()},onDataChange:function(t){this.setProperties(this.fromData(t))},get:c.get,dispose:function(){r.prototype.dispose.call(this),this.emit("dispose")}});var u=i.extend;i.extend=function(t){function e(t){return this instanceof n?void n.call(this,t):new e(t)}var n=this;if(t&&t.mixins){var r=t.mixins;a.apply(void 0,[t].concat(r))}return u.call(n,e,t),e.extend=i.extend,e},i.createClass=i.extend.bind(i),e.exports=i},{"./missing-property-mixin":7,"./watch-property":15,"fast-event-emitter":17,"watchable-object":21,"xtend/mutable":22}],9:[function(t,e){e.exports=function(t,e,n){return t instanceof e?t.setProperties(n):t=new e(n),t}},{}],10:[function(t,e){var n=t("./model"),i=t("./watch-property");e.exports=function(t,e){var r=new n({value:t.get(e)});return i(t,e,r.set.bind(r,"value")),i(r,"value",t.set.bind(t,"value")),r}},{"./model":8,"./watch-property":15}],11:[function(t,e){e.exports=function(t,e,n,i){return i||(i=function(){}),t.uid?n.call(t,i):e.call(t,i)}},{}],12:[function(t,e){(function(n){var i=t("xtend/mutable");e.exports=function(t,e){function r(e){return t.__virtuals[e]?t.__virtuals[e]:t.__virtuals["*"]?function(n){t.__virtuals["*"].call(this,e,n)}:void 0}return t.__virtuals?i(t.__virtuals,e):(t.__virtuals=e,void t.on("missingProperty",function(e){function i(i,r){return i?t.emit("error",i):void(n.browser?n.nextTick(function(){t.set(e,r)}):t.set(e,r))}var s=r(e);if(s){var o=s.call(t,i);void 0!=o&&i(void 0,o)}}))}}).call(this,t("_process"))},{_process:16,"xtend/mutable":22}],13:[function(t,e){e.exports=function(t,e,n,i){t._singletons||(t._singletons={});var r="singleton:"+e;t.once(r,i||function(){});var s=t._singletons[e];return void 0!=s?s:(t._singletons[e]=s={dispose:function(){t._singletons[e]=void 0}},n.call(t,function(e,n){t.emit.apply(t,[r,e,n])}),s)}},{}],14:[function(t,e){function n(t,e){for(var n in t)if(t[n]!==e[n])return!0;return!1}var i=t("./debounce");e.exports={componentDidMount:function(){this._watch()},componentWillUpdate:function(){this._watch()},shouldComponentUpdate:function(t,e){return n(this.props,t)||n(t,this.props)||n(this.state,e)||n(e,this.state)},componentWillUnmount:function(){this._unwatch()},_watch:function(){this._unwatch(),this._watchers=[],this._watchDict(this.props),this._watchDict(this.state)},_watchDict:function(t){var e=i(this.forceUpdate.bind(this),10);for(var n in t){var r=t[n];r&&r.watch&&this._watchers.push(t[n].watch(e))}},_unwatch:function(){if(this._watchers)for(var t=this._watchers.length;t--;)this._watchers[t].dispose();this._watchers=void 0}}},{"./debounce":4}],15:[function(t,e){function n(t,e,n){this.target=t,this.listener=n,this.property=e,this.oldValue=void 0;var i=this;this._disposable=this.target.watch(function(){i.trigger()})}n.prototype.trigger=function(t){var e=this.target.get(this.property);if(t!==!0&&this.oldValue===e)return this;if(this._valueWatcher&&this._valueWatcher.dispose(),e&&e.watch){var n=this;this._valueWatcher=e.watch(function(){n.trigger(!0)})}return this.oldValue=e,this.listener.call(this.target,e,this.oldValue),this},n.prototype.dispose=function(){return this._valueWatcher&&this._valueWatcher.dispose(),this._disposable.dispose(),this},e.exports=function(t,e,i){return new n(t,e,i)}},{}],16:[function(t,e){function n(){if(!o){o=!0;for(var t,e=s.length;e;){t=s,s=[];for(var n=-1;++n<e;)t[n]();e=s.length}o=!1}}function i(){}var r=e.exports={},s=[],o=!1;r.nextTick=function(t){s.push(t),o||setTimeout(n,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=i,r.addListener=i,r.once=i,r.off=i,r.removeListener=i,r.removeAllListeners=i,r.emit=i,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],17:[function(t,e){"use strict";function n(){this.__events={}}t("protoclass");n.prototype.on=function(t,e){if("function"!=typeof e)throw new Error("listener must be a function for event '"+t+"'");var n;(n=this.__events[t])?"function"==typeof n?this.__events[t]=[n,e]:n.push(e):this.__events[t]=e;var i=this;return{dispose:function(){i.off(t,e)}}},n.prototype.off=function(t,e){var n;if(n=this.__events[t])if("function"==typeof n)this.__events[t]=void 0;else{var i=n.indexOf(e);~i&&n.splice(i,1),n.length||(this.__events[t]=void 0)}},n.prototype.once=function(t,e){function n(){i.dispose(),e.apply(this,arguments)}if("function"!=typeof e)throw new Error("listener must be a function for event '"+t+"'");var i=this.on(t,n);return i.target=this,i},n.prototype.emit=function(t){if(void 0!==this.__events[t]){var e,n,i,r=this.__events[t],s=arguments.length;if("function"==typeof r)if(1===s)r();else switch(s){case 2:r(arguments[1]);break;case 3:r(arguments[1],arguments[2]);break;case 4:r(arguments[1],arguments[2],arguments[3]);break;default:for(e=new Array(s-1),n=1;s>n;n++)e[n-1]=arguments[n];r.apply(this,e)}else{for(e=new Array(s-1),n=1;s>n;n++)e[n-1]=arguments[n];for(i=r.length;i--;)r[i]&&r[i].apply(this,e)}}},n.prototype.removeAllListeners=function(t){1===arguments.length?this.__events[t]=void 0:this.__events={}},e.exports=n},{protoclass:18}],18:[function(t,e){function n(t,e){for(var n=0,i=e.length;i>n;n++){var r=e[n];for(var s in r)t[s]=r[s]}return t}function i(t,e){function r(){this.constructor=e}var s=Array.prototype.slice.call(arguments,2);return"function"!=typeof e&&(e&&s.unshift(e),e=t,t=function(){}),n(e,t),r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e.parent=e.superclass=t,n(e.prototype,s),i.setup(e),e}i.setup=function(t){return t.extend||(t.extend=function(t){var e=Array.prototype.slice.call(arguments,0);return"function"!=typeof t&&e.unshift(t=function(){t.parent.apply(this,arguments)}),i.apply(this,[this].concat(e))},t.mixin=function(){n(this.prototype,arguments)},t.create=function(){var e=Object.create(t.prototype);return t.apply(e,arguments),e}),t},e.exports=i},{}],19:[function(t,e){function n(t){i.call(this),this.source=t||[],this.length=this.source.length;var e=this;r(this,"source",function(){e._onChange()}).trigger()}var i=t("watchable-object"),r=t("./watchProperty");i.extend(n,{at:function(t){return t<this.length?this.source[t]:void 0},map:function(t){return this.source.map(t)},filter:function(t){return this.source.filter(t)},forEach:function(t){return this.source.forEach(t)},join:function(t){return this.source.join(t)},pop:function(){return this.splice(this.source.length-1,1).pop()},shift:function(){return this.splice(0,1).pop()},push:function(){this.source.push.apply(this.source,arguments),this._onChange()},unshift:function(){this.source.unshift.apply(this.source,arguments),this._onChange()},indexOf:function(t){return this.source.indexOf(t)},splice:function(){var t=(Array.prototype.splice.apply(2,arguments),this.source.splice.apply(this.source,arguments));return this._onChange(),t},_onChange:function(){this.set("length",this.source.length)||this._triggerChange()}}),e.exports=n},{"./watchProperty":20,"watchable-object":21}],20:[function(t,e){e.exports=function(t,e,n){var i,r,s={trigger:function(){var r=t.get(e);i!==r&&(i=r,n(r,i))},dispose:function(){r.dispose()}};return r=t.watch(s.trigger),s}},{}],21:[function(t,e){function n(t){if(this.__watchable={},t)for(var e in t)this._watchProperty(e,this[e]=t[e])}var i=t("protoclass");i(n,{watch:function(t){this._listeners?"function"==typeof this._listeners?this._listeners=[this._listeners,t]:this._listeners.push(t):this._listeners=t;var e=this;return{dispose:function(){var n=0;e._listeners&&("function"!=typeof e._listeners&&~(n=e._listeners.indexOf(t))?(e._listeners.splice(n,1),0===e._listeners.length&&(e._listeners=void 0)):e._listeners=void 0)}}},get:function(t){var e;if((e="string"==typeof t)&&!~t.indexOf("."))return this[t];for(var n=e?t.split("."):t,i=this,r=0,s=n.length-1;s>r;r++){if(i=i[n[r]],!i)return;if(i.get)return i.get(n.slice(r+1))}return i[n[r]]},set:function(t,e,n){var i;i="string"==typeof t?t.split("."):t;for(var r,s=this,o=this.get(i)!==e,a=0,c=i.length-1;c>a;a++){if(r=s[i[a]],r&&r.set)return r.set(i.slice(a+1),e);r||(r=s[i[a]]={}),s=r}return s[i[a]]=e,this._watchProperty(t,e),n!==!1&&o&&this._triggerChange(),o},_watchProperty:function(t,e){if(e!==this)if(e&&e.watch){var n=this;this.__watchable[t]=e.watch(function(){return n.get(t)?void(n._changing||n._triggerChange()):n._watchProperty(t,void 0)})}else{this.__watchable[t]&&this.__watchable[t].dispose(),this.__watchable[t]=void 0;var i=Object.prototype.toString.call(e);if("[object Object]"===i)for(var r in e)this._watchProperty(t+"."+r,e[r])}},setProperties:function(t){var e=!1;for(var n in t)e=this.set(n,t[n],!1)||e;e&&this._triggerChange()},_triggerChange:function(){this._changing=!0;var t=this;if(t._listeners)if("function"==typeof t._listeners)t._listeners();else for(var e=t._listeners.length;e--;)t._listeners[e]();t._changing=!1},dispose:function(){for(var t in this.__watchable)this.__watchable[t]&&this.__watchable[t].dispose();this.__watchable={},this._listeners=void 0}}),e.exports=n},{protoclass:18}],22:[function(t,e){function n(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t}e.exports=n},{}]},{},[1]);