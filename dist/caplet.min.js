!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){(function(n,r){var s=t("./model"),o=t("./collection");i.Model=s.createClass(),i.Collection=o.createClass(),i.createModelClass=s.createClass,i.createCollectionClass=o.createClass,i.setVirtuals=t("./set-virtuals"),i.load=t("./load"),i.singleton=t("./singleton"),i.save=t("./save"),i.watchProperty=t("./watch-property"),i.bindProperty=t("./bind-property"),i.watchModelsMixin=t("./watch-models-mixin"),i.getAsync=t("./get-async"),n.browser&&(r.Caplet=e.exports)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bind-property":2,"./collection":3,"./get-async":4,"./load":5,"./model":7,"./save":8,"./set-virtuals":9,"./singleton":10,"./watch-models-mixin":11,"./watch-property":12,_process:13}],2:[function(t,e){var i=t("./watch-property");e.exports=function(t,e,n,r){r||(r=e),"string"==typeof n&&(r=n,n=t);var s=i(t,e,function(t){n.set(r,t)});return s}},{"./watch-property":12}],3:[function(t,e){function i(t){var e={};t||(t={}),"[object Array]"===Object.prototype.toString.call(t)?e.source=t:e=t,this.getInitialProperties&&(e=a({},this.getInitialProperties(),e)),this._emitter=new r,n.call(this),this.setProperties(e),this.createModel=this.createModel.bind(this);var i=this;s(this,"data",this.onDataChange).trigger(),this.watch(function(){i._watchModels()}),this.initialize(),this.onChange&&this.watch(function(){i.onChange()}),this._watchModels()}var n=t("watchable-collection"),r=t("fast-event-emitter"),s=t("./watch-property"),o=t("./model").createClass(),a=t("xtend/mutable"),c=t("./missing-property-mixin");n.extend(i,{modelClass:o,initialize:function(){},createModel:function(t){return new this.modelClass(t)},create:function(t){var e=this.createModel(t);return t.waitUntilSave||this.push(e),e},fromData:function(t){return{source:this.castModels(t)}},toData:function(){return this.source.map(function(t){return t.toData()})},toJSON:function(){return this.toData()},onDataChange:function(t){var e=this.fromData(t);e.source=this.mergeSource(e.source),this.setProperties(e)},get:c.get,mergeSource:function(t){for(var e=t.concat(),i=this.source,n=t.length;n--;)for(var r=t[n],s=i.length;s--;){var o=i[s];if(r.equals(o)){o.set("data",r.toData()),e.splice(n,1,o);break}}return e},castModels:function(t){var e=this;return(t||[]).map(function(t){return e.createModel({data:t})})},_watchModels:function(){this._unwatchModels(),this._modelListeners=[];var t=this,e=function(){t._onChange()};this.source.forEach(function(i){t._modelListeners.push(i.watch(e)),t._modelListeners.push(i._emitter.once("dispose",function(){t.splice(t.indexOf(i),1)}))})},_unwatchModels:function(){if(this._modelListeners){for(var t=this._modelListeners.length;t--;)this._modelListeners[t].dispose();this._modelListeners=void 0}}});var h=i.extend;i.extend=function(t){function e(t){return this instanceof n?void n.call(this,t):new e(t)}var n=this;if(t&&t.mixins){var r=t.mixins;a.apply(void 0,[t].concat(r))}return h.call(n,e,t),e.extend=i.extend,e},i.createClass=i.extend.bind(i),e.exports=i},{"./missing-property-mixin":6,"./model":7,"./watch-property":12,"fast-event-emitter":14,"watchable-collection":16,"xtend/mutable":19}],4:[function(t,e){var i=t("./watch-property");e.exports=function(t,e,n){var r=i(t,e,function(t){r.dispose(),n(void 0,t)});r.trigger()}},{"./watch-property":12}],5:[function(t,e){var i=t("./singleton");e.exports=function(t,e,n){i(t,"load",e,function(e,i){return e?n(e):(t.set("data",i),void n(null,t))})}},{"./singleton":10}],6:[function(t,e){var i=t("watchable-object");e.exports={get:function(t){var e=i.prototype.get.call(this,t);if(void 0!=e)return e;var n=("string"==typeof t?t.split("."):t)[0];return this._missingProperties||(this._missingProperties={}),this._missingProperties[n]?void 0:(this._emitter.emit("missingProperty",this._missingProperties[n]=n),void 0!=this[n]?this.get(t):void 0)}}},{"watchable-object":18}],7:[function(t,e){function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function n(t){t=i(t)?t:{data:t},this.getInitialProperties&&(t=a({},this.getInitialProperties(),t)),r.call(this,t),this._emitter=new s;var e=this;o(this,"data",this.onDataChange).trigger(),this.initialize(),this.onChange&&this.watch(function(){e.onChange()})}var r=t("watchable-object"),s=t("fast-event-emitter"),o=t("./watch-property"),a=t("xtend/mutable"),c=t("./missing-property-mixin");r.extend(n,{initialize:function(){},fromData:function(t){return i(t)?t:{}},toData:function(){var t={},e=this.data?this.data:this;if(!i(e))return e;for(var n in e)e===this&&(n in this.constructor.prototype||95===n.charCodeAt(0))||(t[n]=e[n]);return t},equals:function(t){return this.uid&&this.uid===t.uid||this.data===t.data},toJSON:function(){return this.toData()},onDataChange:function(t){this.setProperties(this.fromData(t))},get:c.get,dispose:function(){r.prototype.dispose.call(this),this._emitter.emit("dispose")}});var h=n.extend;n.extend=function(t){function e(t){return this instanceof i?void i.call(this,t):new e(t)}var i=this;if(t&&t.mixins){var r=t.mixins;a.apply(void 0,[t].concat(r))}return h.call(i,e,t),e.extend=n.extend,e},n.createClass=n.extend.bind(n),e.exports=n},{"./missing-property-mixin":6,"./watch-property":12,"fast-event-emitter":14,"watchable-object":18,"xtend/mutable":19}],8:[function(t,e){e.exports=function(t,e,i,n){return n||(n=function(){}),t.uid?i.call(t,n):e.call(t,n)}},{}],9:[function(t,e){(function(i){var n=t("xtend/mutable");e.exports=function(t,e){function r(e){return t.__virtuals[e]?t.__virtuals[e]:t.__virtuals["*"]?function(i){t.__virtuals["*"].call(this,e,i)}:void 0}return t.__virtuals?n(t.__virtuals,e):(t.__virtuals=e,void t._emitter.on("missingProperty",function(e){function n(n,r){return n?t._emitter.emit("error",n):void(i.browser?i.nextTick(function(){t.set(e,r)}):t.set(e,r))}var s=r(e);if(s){var o=s.call(t,n);void 0!=o&&n(void 0,o)}}))}}).call(this,t("_process"))},{_process:13,"xtend/mutable":19}],10:[function(t,e){e.exports=function(t,e,i,n){t._singletons||(t._singletons={});var r="singleton:"+e;t._emitter.once(r,n||function(){});var s=t._singletons[e];return void 0!=s?s:(t._singletons[e]=s={dispose:function(){t._singletons[e]=void 0}},i.call(t,function(e,i){t._emitter.emit.apply(t._emitter,[r,e,i])}),s)}},{}],11:[function(t,e){function i(t,e){for(var i in t)if(t[i]!==e[i])return!0;return!1}e.exports={componentDidMount:function(){this._watch()},componentWillUpdate:function(){this._watch()},shouldComponentUpdate:function(t,e){return i(this.props,t)||i(t,this.props)||i(this.state,e)||i(e,this.state)},componentWillUnmount:function(){this._unwatch()},_watch:function(){this._unwatch(),this._watchers=[],this._watchDict(this.props),this._watchDict(this.state)},_watchDict:function(t){var e=this.forceUpdate.bind(this);for(var i in t){var n=t[i];n&&n.watch&&this._watchers.push(t[i].watch(e))}},_unwatch:function(){if(this._watchers)for(var t=this._watchers.length;t--;)this._watchers[t].dispose();this._watchers=void 0}}},{}],12:[function(t,e){function i(t,e,i){this.target=t,this.listener=i,this.property=e,this.oldValue=void 0;var n=this;this._disposable=this.target.watch(function(){n.trigger()})}i.prototype.trigger=function(t){var e=this.target.get(this.property);if(t!==!0&&this.oldValue===e)return this;if(this._valueWatcher&&this._valueWatcher.dispose(),e&&e.watch){var i=this;this._valueWatcher=e.watch(function(){i.trigger(!0)})}return this.oldValue=e,this.listener.call(this.target,e,this.oldValue),this},i.prototype.dispose=function(){return this._valueWatcher&&this._valueWatcher.dispose(),this._disposable.dispose(),this},e.exports=function(t,e,n){return new i(t,e,n)}},{}],13:[function(t,e){function i(){if(!o){o=!0;for(var t,e=s.length;e;){t=s,s=[];for(var i=-1;++i<e;)t[i]();e=s.length}o=!1}}function n(){}var r=e.exports={},s=[],o=!1;r.nextTick=function(t){s.push(t),o||setTimeout(i,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],14:[function(t,e){"use strict";function i(){this.__events={}}t("protoclass");i.prototype.on=function(t,e){if("function"!=typeof e)throw new Error("listener must be a function for event '"+t+"'");var i;(i=this.__events[t])?"function"==typeof i?this.__events[t]=[i,e]:i.push(e):this.__events[t]=e;var n=this;return{dispose:function(){n.off(t,e)}}},i.prototype.off=function(t,e){var i;if(i=this.__events[t])if("function"==typeof i)this.__events[t]=void 0;else{var n=i.indexOf(e);~n&&i.splice(n,1),i.length||(this.__events[t]=void 0)}},i.prototype.once=function(t,e){function i(){n.dispose(),e.apply(this,arguments)}if("function"!=typeof e)throw new Error("listener must be a function for event '"+t+"'");var n=this.on(t,i);return n.target=this,n},i.prototype.emit=function(t){if(void 0!==this.__events[t]){var e,i,n,r=this.__events[t],s=arguments.length;if("function"==typeof r)if(1===s)r();else switch(s){case 2:r(arguments[1]);break;case 3:r(arguments[1],arguments[2]);break;case 4:r(arguments[1],arguments[2],arguments[3]);break;default:for(e=new Array(s-1),i=1;s>i;i++)e[i-1]=arguments[i];r.apply(this,e)}else{for(e=new Array(s-1),i=1;s>i;i++)e[i-1]=arguments[i];for(n=r.length;n--;)r[n]&&r[n].apply(this,e)}}},i.prototype.removeAllListeners=function(t){1===arguments.length?this.__events[t]=void 0:this.__events={}},e.exports=i},{protoclass:15}],15:[function(t,e){function i(t,e){for(var i=0,n=e.length;n>i;i++){var r=e[i];for(var s in r)t[s]=r[s]}return t}function n(t,e){function r(){this.constructor=e}var s=Array.prototype.slice.call(arguments,2);return"function"!=typeof e&&(e&&s.unshift(e),e=t,t=function(){}),i(e,t),r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e.parent=e.superclass=t,i(e.prototype,s),n.setup(e),e}n.setup=function(t){return t.extend||(t.extend=function(t){var e=Array.prototype.slice.call(arguments,0);return"function"!=typeof t&&e.unshift(t=function(){t.parent.apply(this,arguments)}),n.apply(this,[this].concat(e))},t.mixin=function(){i(this.prototype,arguments)},t.create=function(){var e=Object.create(t.prototype);return t.apply(e,arguments),e}),t},e.exports=n},{}],16:[function(t,e){function i(t){n.call(this),this.source=t||[],this.length=this.source.length;var e=this;r(this,"source",function(){e._onChange()}).trigger()}var n=t("watchable-object"),r=t("./watchProperty");n.extend(i,{at:function(t){return t<this.length?this.source[t]:void 0},map:function(t){return this.source.map(t)},filter:function(t){return this.source.filter(t)},forEach:function(t){return this.source.forEach(t)},join:function(t){return this.source.join(t)},pop:function(){return this.splice(this.source.length-1,1).pop()},shift:function(){return this.splice(0,1).pop()},push:function(){this.source.push.apply(this.source,arguments),this._onChange()},unshift:function(){this.source.unshift.apply(this.source,arguments),this._onChange()},indexOf:function(t){return this.source.indexOf(t)},splice:function(){var t=(Array.prototype.splice.apply(2,arguments),this.source.splice.apply(this.source,arguments));return this._onChange(),t},_onChange:function(){this.set("length",this.source.length)||this._triggerChange()}}),e.exports=i},{"./watchProperty":17,"watchable-object":18}],17:[function(t,e){e.exports=function(t,e,i){var n,r,s={trigger:function(){var r=t.get(e);n!==r&&(n=r,i(r,n))},dispose:function(){r.dispose()}};return r=t.watch(s.trigger),s}},{}],18:[function(t,e){function i(t){if(this.__watchable={},t)for(var e in t)this._watchProperty(e,this[e]=t[e])}var n=t("protoclass");n(i,{watch:function(t){this._listeners?"function"==typeof this._listeners?this._listeners=[this._listeners,t]:this._listeners.push(t):this._listeners=t;var e=this;return{dispose:function(){var i=0;e._listeners&&("function"!=typeof e._listeners&&~(i=e._listeners.indexOf(t))?(e._listeners.splice(i,1),0===e._listeners.length&&(e._listeners=void 0)):e._listeners=void 0)}}},get:function(t){var e;if((e="string"==typeof t)&&!~t.indexOf("."))return this[t];for(var i=e?t.split("."):t,n=this,r=0,s=i.length-1;s>r;r++){if(n=n[i[r]],!n)return;if(n.get)return n.get(i.slice(r+1))}return n[i[r]]},set:function(t,e,i){var n;n="string"==typeof t?t.split("."):t;for(var r,s=this,o=this.get(n)!==e,a=0,c=n.length-1;c>a;a++){if(r=s[n[a]],r&&r.set)return r.set(n.slice(a+1),e);r||(r=s[n[a]]={}),s=r}return s[n[a]]=e,this._watchProperty(t,e),i!==!1&&o&&this._triggerChange(),o},_watchProperty:function(t,e){if(e!==this)if(e&&e.watch){var i=this;this.__watchable[t]=e.watch(function(){return i.get(t)?void(i._changing||i._triggerChange()):i._watchProperty(t,void 0)})}else{this.__watchable[t]&&this.__watchable[t].dispose(),this.__watchable[t]=void 0;var n=Object.prototype.toString.call(e);if("[object Object]"===n)for(var r in e)this._watchProperty(t+"."+r,e[r])}},setProperties:function(t){var e=!1;for(var i in t)e=this.set(i,t[i],!1)||e;e&&this._triggerChange()},_triggerChange:function(){this._changing=!0;var t=this;if(t._listeners)if("function"==typeof t._listeners)t._listeners();else for(var e=t._listeners.length;e--;)t._listeners[e]();t._changing=!1},dispose:function(){for(var t in this.__watchable)this.__watchable[t]&&this.__watchable[t].dispose();this.__watchable={},this._listeners=void 0}}),e.exports=i},{protoclass:15}],19:[function(t,e){function i(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t}e.exports=i},{}]},{},[1]);